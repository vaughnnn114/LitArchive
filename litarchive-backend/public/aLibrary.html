                                    <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>LitArchive</title>
                    <link rel="icon" href="./images/LitArchive_Logo.png" type="image/png">
                    <link rel="stylesheet" href="./css and js/Library.css">
                    <link rel="stylesheet" href="./css and js/profile.css">
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                    <style>
                        /* Enhanced Book Display */
                        .book-item {
                            position: relative;
                            overflow: hidden;
                            transition: all 0.3s ease;
                        }

                        .book-item:hover {
                            transform: translateY(-5px);
                            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
                        }

                        .book-image {
                            transition: transform 0.3s ease;
                        }

                        .book-item:hover .book-image {
                            transform: scale(1.05);
                        }

                        .book-overlay {
                            position: absolute;
                            top: 0;
                            left: 0;
                            right: 0;
                            bottom: 0;
                            background: rgba(0,0,0,0.7);
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            opacity: 0;
                            transition: opacity 0.3s ease;
                        }

                        .book-item:hover .book-overlay {
                            opacity: 1;
                        }

                        .book-status {
                            position: absolute;
                            top: 10px;
                            right: 10px;
                            padding: 5px 10px;
                            border-radius: 15px;
                            font-size: 12px;
                            font-weight: bold;
                            z-index: 1;
                        }

                        .book-status.available {
                            background: #28a745;
                            color: white;
                        }

                        .book-status.checked-out {
                            background: #dc3545;
                            color: white;
                        }

                        /* Enhanced Search Bar */
                        .search-wrapper {
                            position: relative;
                            margin: 20px auto;
                            max-width: 800px;
                        }

                        #searchbar {
                            width: 100%;
                            padding: 15px 20px;
                            padding-left: 50px;
                            border: 2px solid #e0e0e0;
                            border-radius: 25px;
                            font-size: 16px;
                            transition: all 0.3s ease;
                        }

                        #searchbar:focus {
                            border-color: #004d99;
                            box-shadow: 0 0 10px rgba(0,77,153,0.1);
                            outline: none;
                        }

                        .search-icon {
                            position: absolute;
                            left: 20px;
                            top: 50%;
                            transform: translateY(-50%);
                            color: #666;
                        }

                        /* Enhanced Category Filter */
                        .catg {
                            padding: 15px 25px;
                            border: 2px solid #e0e0e0;
                            border-radius: 25px;
                            font-size: 16px;
                            background: white;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            margin-left: 10px;
                            color: black;
                        }

                        .catg option {
                            color: black;
                            background: white;
                        }

                        .catg:focus {
                            border-color: #004d99;
                            box-shadow: 0 0 10px rgba(0,77,153,0.1);
                            outline: none;
                        }

                        /* Book Details Modal */
                        .modal-content {
                            max-width: 600px;
                            padding: 30px;
                            border-radius: 15px;
                        }

                        .modal-book-image {
                            width: 200px;
                            height: 300px;
                            object-fit: cover;
                            border-radius: 10px;
                            margin-bottom: 20px;
                        }

                        .modal-details {
                            margin-top: 20px;
                        }

                        .modal-details h2 {
                            color: #004d99;
                            margin-bottom: 15px;
                        }

                        .modal-details p {
                            margin: 10px 0;
                            color: #666;
                        }

                        .borrow-button {
                            background: #004d99;
                            color: white;
                            padding: 12px 25px;
                            border: none;
                            border-radius: 25px;
                            font-size: 16px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                            margin-top: 20px;
                        }

                        .borrow-button:hover {
                            background: #003366;
                            transform: translateY(-2px);
                        }

                        .borrow-button:disabled {
                            background: #ccc;
                            cursor: not-allowed;
                        }

                        /* Loading Animation */
                        .loading {
                            display: none;
                            text-align: center;
                            padding: 20px;
                        }

                        .loading::after {
                            content: "Loading...";
                            animation: dots 1.5s infinite;
                        }

                        @keyframes dots {
                            0%, 20% { content: "Loading."; }
                            40% { content: "Loading.."; }
                            60% { content: "Loading..."; }
                            80%, 100% { content: "Loading...."; }
                        }

                        /* Notification Badge */
                        .notification-badge {
                            position: absolute;
                            top: -5px;
                            right: -5px;
                            background: #dc3545;
                            color: white;
                            border-radius: 50%;
                            width: 20px;
                            height: 20px;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-size: 12px;
                            font-weight: bold;
                        }

                        /* Compact Footer Styles */
                        footer {
                            background-color: #004d99;
                            color: white;
                            padding: 15px 0;
                            margin-top: 30px;
                            font-size: 14px;
                        }
                        
                        .footer-container {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            max-width: 1200px;
                            margin: 0 auto;
                            padding: 0 20px;
                        }
                        
                        .footer-left {
                            flex: 1;
                        }
                        
                        .footer-brand {
                            font-weight: bold;
                            font-size: 16px;
                            display: block;
                            margin-bottom: 3px;
                        }
                        
                        .footer-left p {
                            margin: 0;
                            opacity: 0.8;
                        }
                        
                        .footer-center {
                            flex: 2;
                            display: flex;
                            justify-content: center;
                            gap: 20px;
                        }
                        
                        .footer-center a {
                            color: white;
                            text-decoration: none;
                            transition: opacity 0.3s;
                        }
                        
                        .footer-center a:hover {
                            opacity: 0.8;
                        }
                        
                        .footer-right {
                            flex: 1;
                            text-align: right;
                        }
                        
                        .social-mini {
                            display: flex;
                            justify-content: flex-end;
                            gap: 10px;
                            margin-bottom: 3px;
                        }
                        
                        .social-mini a {
                            color: white;
                            font-size: 14px;
                            opacity: 0.8;
                            transition: opacity 0.3s;
                        }
                        
                        .social-mini a:hover {
                            opacity: 1;
                        }
                        
                        .copyright {
                            margin: 0;
                            font-size: 12px;
                            opacity: 0.7;
                        }
                        
                        /* Dark mode adjustments */
                        body.dark-mode footer {
                            background-color: #1a1a2e;
                        }
                        
                        @media (max-width: 600px) {
                            .footer-container {
                                flex-direction: column;
                                text-align: center;
                                gap: 10px;
                            }
                            
                            .footer-center {
                                order: 3;
                            }
                            
                            .footer-right {
                                order: 2;
                                text-align: center;
                            }
                            
                            .social-mini {
                                justify-content: center;
                            }
                        }

                        .share-button:hover {
                            background-color: #e9ecef;
                        }
                        
                        .ebook-button {
                            background-color: #6a5acd;
                            color: white;
                            border: none !important;
                        }
                        
                        .ebook-button:hover {
                            background-color: #5b4cbe;
                            transform: translateY(-2px);
                        }
                        
                        .ebook-button:disabled {
                            background-color: #cccccc;
                            cursor: not-allowed;
                            transform: none;
                        }

                        .book-tags {
                            margin-top: 10px;
                        }

                        .centered-modal {
                          display: flex !important;
                          align-items: center;
                          justify-content: center;
                        }

                        .modal-overlay {
                          display: none;
                          position: fixed;
                          z-index: 9999;
                          left: 0; top: 0; width: 100vw; height: 100vh;
                          background: rgba(0,0,0,0.5);
                          justify-content: center;
                          align-items: center;
                        }
                        .modal-overlay.active {
                          display: flex !important;
                        }
                        .borrow-modal-content {
                          background: #fff;
                          padding: 30px;
                          border-radius: 10px;
                          max-width: 350px;
                          width: 90vw;
                          box-sizing: border-box;
                          margin: auto;
                          text-align: center;
                        }
                    </style>
                </head>
                <body id="aLibrary-page">
                    <header>
                        <div class="header-content">
                            <h1 class="logo">
                                <span class="logo-text">
                                    <span class="logo-lit">Lit</span>
                                    <span class="logo-archive">Archive</span>
                                </span>
                            </h1>
                            <div class="library-hours">Library Hours: 10am - 4pm</div>
                            
                            <!-- Profile Section -->
                            <div class="profile-section">
                                <div class="profile-dropdown">
                                    <button class="profile-button" onclick="toggleProfileDropdown()">
                                        <img src="./images/download.jfif" alt="Profile" class="profile-icon" id="profileIcon" style="width: 50px; height: 50px; border-radius: 50%; object-fit: cover;">
                                        <span id="username-display" class="username-text">User</span>
                                        <i class="fas fa-chevron-down"></i>
                                    </button>
                                    <div id="profile-dropdown-content" class="dropdown-content">
                                        <a href="profile.html">Edit Profile</a>
                                        <a href="#" onclick="viewBorrowedBooks()">My Borrowed Books</a>
                                        <a href="#" onclick="viewHistory()">Borrowing History</a>
                                        <a href="#" onclick="logout()">Logout</a>
                                        <div style="padding: 10px 20px; display: flex; align-items: center; gap: 10px;">
                                            <input type="checkbox" class="checkbox" id="checkbox" style="margin: 0;">
                                            <label for="checkbox" class="checkbox-label" style="margin: 0; cursor: pointer;">
                                                <i class="fas fa-moon"></i>
                                                <i class="fas fa-sun"></i>
                                                <span class="ball"></span>
                                                <span style="margin-left: 8px; font-size: 14px;">Dark Mode</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>
                <main>
                    
                    <div class="container">
                        <div class="search-wrapper">
                            
                            <i class="fas fa-search search-icon"></i>
                            <input id="searchbar" type="text" name="search" placeholder="Search for books..." autocomplete="off" onkeyup="search_books()">
                            <select class="catg" id="categoryFilter" onchange="search_books()">
                                <option value="all">All Categories</option>
                                <!-- Categories will be dynamically populated from the database -->
                            </select>
                        </div>

                    
            
                        
                        
                        <!-- Available count display (for "All Books") -->
                        <div id="available-count" class="available-count-display">Available Books: 0</div>
                        <div id="loading" class="loading"></div>
                        <div id="book-list">
                        <div class="books-wrapper">
                            <button class="nav-arrow prev" onclick="scrollBooks(-1)">&#10094;</button>
                            
                            <div class="book-container">
                                <ul id="list" class="book-list">
                                    
                                </ul>
                                
                            </div>
                            <button class="nav-arrow next" onclick="scrollBooks(1)">&#10095;</button>
                        </div>
                        </div>
                    </div>
                    
                    
                    

                    <!-- Book Details Modal -->
    <div id="book-modal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeBookModal()">&times;</span>
            <div class="modal-body">
                <div class="modal-left">
                    <img id="modal-book-image" class="modal-book-image" alt="Book Image">
                    <div class="book-rating">
                        <span class="star-rating" id="modal-book-rating"></span>
                        <span id="modal-book-rating-count"></span>
                    </div>
                    <div class="book-actions">
                        <button id="borrow-button" class="borrow-button" onclick="borrowBook()">Borrow</button>
                        <button class="wishlist-button" onclick="addToWishlist()"><i class="fas fa-bookmark"></i> Add to Wishlist</button>
                        <button class="share-button" onclick="shareBook()"><i class="fas fa-share-alt"></i> Share</button>
                        <button id="ebook-button" class="ebook-button" onclick="openEbook()"><i class="fas fa-tablet-alt"></i> View eBook</button>
                    </div>
                </div>
                <div class="modal-right">
                    <div class="book-tags" id="modal-book-tags"></div>
                    <h2 id="modal-book-title"></h2>
                    <h3 id="modal-book-author">by <span id="author-name"></span></h3>
                    <div class="book-availability">
                        <span id="modal-book-status"></span>
                        <span id="modal-book-copies"></span>
                    </div>
                    <div class="book-details-section">
                        <h4>Description</h4>
                        <p id="modal-book-description"></p>
                    </div>
                    <div class="book-details-section">
                        <h4>Book Details</h4>
                        <div class="book-meta">
                            <div class="meta-item">
                                <strong>Author:</strong> <span id="modal-book-author-meta">Unknown</span>
                            </div>
                            <div class="meta-item">
                                <strong>Pages:</strong> <span id="modal-book-pages">Unknown</span>
                            </div>
                            <div class="meta-item">
                                <strong>ISBN:</strong> <span id="modal-book-isbn">Unknown</span>
                            </div>
                            <div class="meta-item">
                                <strong>Language:</strong> <span id="modal-book-language">English</span>
                            </div>
                            <div class="meta-item">
                                <strong>Publication Date:</strong> <span id="modal-book-publication-date">Unknown</span>
                            </div>
                            <div class="meta-item">
                                <strong>Categories:</strong> <span id="modal-book-categories">General</span>
                            </div>
                        </div>
                    </div>
                    <div class="book-details-section">
                        <h4>Location in Library</h4>
                        <div class="library-location">
                            <div><strong>Section:</strong> <span id="modal-book-section">General</span></div>
                            <div><strong>Shelf:</strong> <span id="modal-book-shelf">A1</span></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="book-tabs">
                <div class="tab-buttons">
                    <button class="tab-button active" onclick="openTab(event, 'reviews')">Reviews</button>
                    <button class="tab-button" onclick="openTab(event, 'similar')">Similar Books</button>
                    <button class="tab-button" onclick="openTab(event, 'history')">Borrowing History</button>
                </div>
                <div id="reviews" class="tab-content active">
                    <div class="review-list" id="book-reviews">
                        <p class="no-reviews">No reviews yet. Be the first to review this book!</p>
                    </div>
                    <div class="add-review">
                        <h4>Add Your Review</h4>
                        <div class="rating-input">
                            <span>Your Rating: </span>
                            <div class="star-input">
                                <i class="fas fa-star" data-rating="1"></i>
                                <i class="fas fa-star" data-rating="2"></i>
                                <i class="fas fa-star" data-rating="3"></i>
                                <i class="fas fa-star" data-rating="4"></i>
                                <i class="fas fa-star" data-rating="5"></i>
                            </div>
                        </div>
                        <textarea id="review-text" placeholder="Write your review here..."></textarea>
                        <button onclick="submitReview()">Submit Review</button>
                    </div>
                </div>
                <div id="similar" class="tab-content">
                    <div class="similar-books" id="similar-books-container">
                        <p>Loading similar books...</p>
                    </div>
                </div>
                <div id="history" class="tab-content">
                    <div class="borrowing-history" id="borrowing-history-container">
                        <p>No borrowing history available for this book.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
                </main>
            
                <footer>
                    <div class="footer-container">
                        <div class="footer-left">
                            <span class="footer-brand">LitArchive</span>
                            <p>Your digital gateway to knowledge</p>
                        </div>
                        <div class="footer-center">
                        <a href="about.html">About</a>   
                            <a href="feedback.html">Feedback</a>
                        <a href="reviews.html">Reviews</a>
                            <a href="#">FAQs</a>
                        </div>
                        <div class="footer-right">
                            <div class="social-mini">
                                <a href="#"><i class="fab fa-facebook-f"></i></a>
                                <a href="#"><i class="fab fa-twitter"></i></a>
                                <a href="#"><i class="fab fa-instagram"></i></a>
                            </div>
                            <p class="copyright">&copy; 2025     LitArchive</p>
                        </div>
                    </div>
                </footer>
                
                <!-- Popup Modal for Available Books -->
    <div id="books-popup" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="closeBooksPopup()">&times;</span>
            <h2>Available Books</h2>
            <input id="popup-search-bar" type="text" placeholder="Search for books..." onkeyup="filterAvailableBooks()">
            <ul id="available-books-list"></ul>
        </div>
    </div>

    <!-- Popup for displaying approved books -->
    <div id="approved-books-popup" id="approved-books-section" class="popup">
        <div class="popup-content">
            <span id="close-popup" class="close">&times;</span>
            <h2>Approved Books</h2>
            <ul id="approved-books-list">
                <!-- Approved books will be dynamically added here -->
            </ul>
        </div>
    </div>

    <!-- Borrow Confirmation Modal -->
    <div id="borrow-confirm-modal" class="modal-overlay">
      <div class="modal-content borrow-modal-content">
        <h3>Borrow Book</h3>
        <p id="borrow-confirm-title">Do you want to borrow this book?</p>
        <label for="return-date">Select return date:</label><br>
        <input type="date" id="return-date" min="" required style="margin:10px 0; padding:5px; width:100%; max-width:200px;">
        <div style="margin-top:15px;">
          <button id="confirm-borrow-btn" style="background:#004d99; color:#fff; border:none; border-radius:5px; padding:8px 18px; margin-right:10px;">Confirm</button>
          <button id="cancel-borrow-btn" style="background:#ccc; color:#333; border:none; border-radius:5px; padding:8px 18px;">Cancel</button>
        </div>
      </div>
    </div>
                <script>
                    document.addEventListener("DOMContentLoaded", () => {
        const viewBorrowedBooksBtn = document.getElementById("view-borrowed-books-btn");
        const modal = document.getElementById("borrowed-books-modal");
        const closeModal = document.querySelector(".close-modal");
        const borrowedBooksList = document.getElementById("borrowed-books-list");

        // Load user profile image
function loadUserProfile() {
    let currentUser = localStorage.getItem('currentUser');
    // If currentUser is a stringified object, parse it
    try {
        const parsed = JSON.parse(currentUser);
        if (typeof parsed === 'object' && parsed !== null) {
            currentUser = parsed.username || parsed.name || '';
        }
    } catch (e) {
        // Not a JSON object, keep as is
    }
    if (!currentUser) currentUser = '';
    const users = JSON.parse(localStorage.getItem('Users')) || {};
    const userData = users[currentUser] || {};
    // Try to get the profile picture from Users object, fallback to global profilePicture
    let profilePicSrc = userData.profilePicture || localStorage.getItem('profilePicture') || './images/default-profile.png';
    // Update profile image
    const profileIcon = document.getElementById('profileIcon');
    if (profileIcon) {
        profileIcon.src = profilePicSrc;
    }
    // Update username
    const usernameDisplay = document.getElementById('username-display');
    let displayName = userData.fullName || localStorage.getItem('profileName') || currentUser || 'User';
    if (typeof displayName !== 'string' || displayName.length > 30) {
        displayName = 'User';
    }
    if (usernameDisplay) {
        usernameDisplay.textContent = displayName;
    }
}

        // Call the function to load profile on page load
        document.addEventListener('DOMContentLoaded', loadUserProfile);
        window.addEventListener('load', loadUserProfile);
        
        // Load categories and display books
        loadCategories();
        displayBooks();
        
        // Toggle profile dropdown function
function toggleProfileDropdown() {
    const dropdownContent = document.getElementById('profile-dropdown-content');
    if (dropdownContent.style.display === 'block') {
        dropdownContent.style.display = 'none';
    } else {
        dropdownContent.style.display = 'block';
    }
}
window.toggleProfileDropdown = toggleProfileDropdown;

        // Logout function
        window.logout = function() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        };
        
        // View borrowed books function
        window.viewBorrowedBooks = function() {
            // Implement this functionality or redirect to appropriate page
            alert('View borrowed books functionality will be implemented here');
        };
        
        // View history function
        window.viewHistory = function() {
            // Implement this functionality or redirect to appropriate page
            alert('View history functionality will be implemented here');
        };

        function displayApprovedBooks() {
        const approvedBooksList = document.getElementById("approved-books-list");
        
        // Get approved borrow requests from localStorage
        const borrowRequests = JSON.parse(localStorage.getItem("borrowRequests")) || [];
        const approvedBooks = borrowRequests.filter(request => request.status === "Approved");

        // Clear the list first
        approvedBooksList.innerHTML = "";

        if (approvedBooks.length === 0) {
            approvedBooksList.innerHTML = "<li>No approved books found.</li>";
            return;
        }

        // Display each approved book with a countdown timer
        approvedBooks.forEach(request => {
            const requestItem = document.createElement("li");

            const bookTitle = request.bookTitle;
            const dueDate = new Date(request.dueDate);

            // Create the countdown timer
            const countdown = document.createElement("span");
            countdown.id = `countdown-${request.bookTitle}`;
            updateCountdown(dueDate, countdown);

            requestItem.innerHTML = `
                <div>
                   
                    <div>
                        <h3>${bookTitle}</h3>
                        <p>Due Date: ${dueDate.toDateString()}</p>
                        <p id="countdown-${bookTitle}"></p> <!-- Timer will be shown here -->
                    </div>
                </div>
            `;
            requestItem.appendChild(countdown);
            approvedBooksList.appendChild(requestItem);
        });
    }

    // Call displayApprovedBooks on page load to show the books and their timers
    document.addEventListener("DOMContentLoaded", displayApprovedBooks);

    // Call displayApprovedBooks on page load to show the books and their timers
    document.addEventListener("DOMContentLoaded", displayApprovedBooks);

    function updateCountdown(dueDate, countdownElement) {
        const interval = setInterval(() => {
            const now = new Date();
            const timeRemaining = dueDate - now;

            if (timeRemaining <= 0) {
                clearInterval(interval);
                countdownElement.textContent = "The book is overdue!";
            } else {
                const days = Math.floor(timeRemaining / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeRemaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeRemaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeRemaining % (1000 * 60)) / 1000);

                countdownElement.textContent = `Time Remaining: ${days}d ${hours}h ${minutes}m ${seconds}s`;
            }
        }, 1000); // Update every second
    }

    // Call displayApprovedBooks on page load to show the books and their timers
    document.addEventListener("DOMContentLoaded", displayApprovedBooks);

    // Get references to the popup and the button
    const popup = document.getElementById("approved-books-popup");
    const btn = document.getElementById("view-approved-books");
    const closeBtn = document.getElementById("close-popup");

        // Show the popup when the button is clicked
    btn.addEventListener("click", () => {
        displayApprovedBooks();
        popup.style.display = "block";
    });

        // Close the popup when the close button is clicked
    closeBtn.addEventListener("click", () => {
        popup.style.display = "none";
    });

        function openBooksPopup() {
        const booksPopup = document.getElementById("books-popup");
        booksPopup.style.display = "block";
    }

    function closeBooksPopup() {
        const booksPopup = document.getElementById("books-popup");
        booksPopup.style.display = "none";
    }

    // Close the popup if the user clicks outside of the popup content
    window.addEventListener("click", (event) => {
        if (event.target === popup) {
            popup.style.display = "none";
        }
    });
                    });
                    // Function to load and display categories from books
                    function loadCategories() {
                        fetch('http://192.168.1.16:3001/api/books')
                            .then(response => response.json())
                            .then(books => {
                                const categorySelect = document.getElementById("categoryFilter");
                                // Extract unique categories from books
                                const categoriesSet = new Set();
                                books.forEach(book => {
                                    if (book.category) categoriesSet.add(book.category.toLowerCase());
                                });
                                // Clear existing options except "All Categories"
                                categorySelect.innerHTML = '<option value="all">All Categories</option>';
                                // Add categories from books
                                categoriesSet.forEach(category => {
                                    const option = document.createElement("option");
                                    option.value = category;
                                    option.textContent = category.charAt(0).toUpperCase() + category.slice(1);
                                    categorySelect.appendChild(option);
                                });
                                // Update available count
                                updateAvailableCount(books);
                            });
                    }

                    // Function to update available books count
                    function updateAvailableCount(books = null) {
                        if (books) {
                            const availableBooks = books.filter(book => (book.status || '').toLowerCase() === "available");
                            document.getElementById('available-count').textContent = `Available Books: ${availableBooks.length}`;
                        } else {
                            fetch('http://192.168.1.16:3001/api/books')
                                .then(response => response.json())
                                .then(books => {
                                    const availableBooks = books.filter(book => (book.status || '').toLowerCase() === "available");
                                    document.getElementById('available-count').textContent = `Available Books: ${availableBooks.length}`;
                                });
                        }
                    }

                    // Function to display books from backend with an optional genre filter
                    function displayBooks(filterGenre = 'all'){
                        const bookList = document.getElementById("list");
                        const loading = document.getElementById('loading');
                        loading.style.display = 'block';
                        bookList.innerHTML = "";
                        fetch('http://192.168.1.16:3001/api/books')
                            .then(response => response.json())
                            .then(books => {
                                setTimeout(() => {
                                    if (books.length === 0) {
                                        bookList.innerHTML = `
                                            <li class="book-item" style="text-align: center; padding: 20px;">
                                                <p>No books available.</p>
                                            </li>`;
                                    } else {
                                        const filteredBooks = books.filter((book) => {
                                            if (filterGenre === 'all') return true;
                                            if (book.categories && Array.isArray(book.categories)) {
                                                return book.categories.some(cat => cat.toLowerCase() === filterGenre.toLowerCase());
                                            }
                                            const bookCategory = book.category || book.genre;
                                            return (bookCategory || '').toLowerCase() === filterGenre.toLowerCase();
                                        });
                                        if (filteredBooks.length === 0) {
                                            bookList.innerHTML = `
                                                <li class="book-item" style="text-align: center; padding: 20px;">
                                                    <p>No books found for this category.</p>
                                                </li>`;
                                        } else {
                                            filteredBooks.forEach((book) => {
                                                const bookItem = document.createElement("li");
                                                let categoryClasses = 'all';
                                                if (book.categories && Array.isArray(book.categories)) {
                                                    categoryClasses += ' ' + book.categories.join(' ');
                                                } else if (book.category) {
                                                    categoryClasses += ' ' + book.category;
                                                }
                                                bookItem.className = `book-item ${categoryClasses}`;
                                                bookItem.innerHTML = `
                                                    <div class="book-image-wrapper">
                                                        <img src="${book.image}" alt="${book.title}" class="book-image" onclick="showBookDetails('${book.title.replace(/'/g, "\\'")}', '${book.image}', '${book.description}', '${book.status}', ${book.copies})">
                                                    </div>
                                                    <div class="book-info">
                                                        <span class="book-title">${book.title}</span>
                                                        <span class="book-author">${book.author || ''}</span>
                                                        <span class="book-status ${book.status && book.status.toLowerCase() === 'available' ? 'available' : 'checked-out'}">${book.status}</span>
                                                    </div>
                                                `;
                                                bookList.appendChild(bookItem);
                                            });
                                        }
                                    }
                                    loading.style.display = 'none';
                                }, 300);
                            });
                    }

                    // Function to show book details (fetches full book info from backend)
                    function showBookDetails(title) {
                        fetch('http://192.168.1.16:3001/api/books')
                            .then(response => response.json())
                            .then(books => {
                                const book = books.find(b => b.title === title);
                                if (!book) {
                                    alert('Book not found.');
                                    return;
                                }
                                const modal = document.getElementById('book-modal');
                                const modalImage = document.getElementById('modal-book-image');
                                const modalTitle = document.getElementById('modal-book-title');
                                const modalDescription = document.getElementById('modal-book-description');
                                const modalStatus = document.getElementById('modal-book-status');
                                const modalCopies = document.getElementById('modal-book-copies');
                                const borrowButton = document.getElementById('borrow-button');
                                const ebookButton = document.getElementById('ebook-button');
                                const authorSpan = document.getElementById('author-name');
                                const bookRating = document.getElementById('modal-book-rating');
                                const bookRatingCount = document.getElementById('modal-book-rating-count');
                                const bookTags = document.getElementById('modal-book-tags');
                                const publisherSpan = document.getElementById('modal-book-publisher');
                                const pagesSpan = document.getElementById('modal-book-pages');
                                const isbnSpan = document.getElementById('modal-book-isbn');
                                const languageSpan = document.getElementById('modal-book-language');
                                const publicationDateSpan = document.getElementById('modal-book-publication-date');
                                const categoriesSpan = document.getElementById('modal-book-categories');
                                const sectionSpan = document.getElementById('modal-book-section');
                                const shelfSpan = document.getElementById('modal-book-shelf');

                                // Reset tabs to show reviews by default
                                openTab(null, 'reviews');

                                // Set all book details from the database
                                modalImage.src = book.image;
                                modalTitle.textContent = book.title;
                                modalDescription.textContent = book.description;
                                modalStatus.textContent = `Status: ${book.status}`;
                                modalStatus.className = book.status && book.status.toLowerCase() === "available" ? "available" : "checked-out";
                                modalCopies.textContent = `Copies Available: ${book.copies}`;
                                authorSpan.textContent = book.author;
                                isbnSpan.textContent = book.isbn;
                                publisherSpan.textContent = book.publisher || "Unknown";
                                pagesSpan.textContent = book.pages || Math.floor(Math.random() * 400) + 100;
                                languageSpan.textContent = book.language || "English";
                                publicationDateSpan.textContent = book.publicationDate || generateRandomDate();

                                // Set categories display
                                if (book.categories && Array.isArray(book.categories) && book.categories.length > 0) {
                                    categoriesSpan.textContent = book.categories
                                        .filter(cat => cat && typeof cat === 'string')
                                        .map(cat => cat.charAt(0).toUpperCase() + cat.slice(1))
                                        .join(', ');
                                } else if (book.category) {
                                    categoriesSpan.textContent = book.category.charAt(0).toUpperCase() + book.category.slice(1);
                                } else {
                                    categoriesSpan.textContent = "General";
                                }

                                // Set library location
                                let sectionName = "General";
                                if (book.categories && Array.isArray(book.categories) && book.categories.length > 0) {
                                    const sections = book.categories.map(cat => getCategorySection(cat)).filter(Boolean);
                                    if (sections.length > 0) {
                                        sectionName = sections[0];
                                    }
                                } else if (book.category) {
                                    sectionName = getCategorySection(book.category);
                                }
                                sectionSpan.textContent = book.section || sectionName;
                                shelfSpan.textContent = book.shelf || generateRandomShelf();

                                // Add book tags
                                bookTags.innerHTML = '';
                                const tags = [];
                                if (book.categories && Array.isArray(book.categories)) {
                                    tags.push(...book.categories);
                                } else if (book.category) {
                                    tags.push(book.category);
                                } else {
                                    tags.push('General');
                                }
                                if (book.tags) {
                                    tags.push(...book.tags);
                                } else {
                                    const possibleTags = ['Bestseller', 'New Release', 'Classic', 'Award Winner', 'Popular', 'Recommended'];
                                    const randomTag = possibleTags[Math.floor(Math.random() * possibleTags.length)];
                                    tags.push(randomTag);
                                }
                                tags.forEach(tag => {
                                    const tagElem = document.createElement('span');
                                    tagElem.className = 'book-tag';
                                    tagElem.textContent = tag;
                                    bookTags.appendChild(tagElem);
                                });

                                // Handle eBook button
                                if (book.ebookLink && book.ebookLink.trim() !== "") {
                                    ebookButton.style.display = 'flex';
                                    ebookButton.replaceWith(ebookButton.cloneNode(true));
                                    const newEbookButton = document.getElementById('ebook-button');
                                    newEbookButton.setAttribute('data-ebook-link', book.ebookLink);
                                } else if (book.link && book.link.trim() !== "") {
                                    ebookButton.style.display = 'flex';
                                    ebookButton.replaceWith(ebookButton.cloneNode(true));
                                    const newEbookButton = document.getElementById('ebook-button');
                                    newEbookButton.setAttribute('data-ebook-link', book.link);
                                } else {
                                    ebookButton.style.display = 'none';
                                }

                                // Generate a random rating for demo purposes
                                const rating = book.rating || (Math.floor(Math.random() * 50) / 10 + 3).toFixed(1);
                                const ratingCount = book.ratingCount || Math.floor(Math.random() * 100) + 5;
                                bookRating.innerHTML = generateStarRating(rating);
                                bookRatingCount.textContent = `(${ratingCount} ratings)`;

                                // Save the current book details globally for borrowing
                                window.currentBook = {
                                    title: book.title,
                                    image: book.image,
                                    description: book.description,
                                    status: book.status,
                                    copies: book.copies,
                                    author: book.author,
                                    categories: book.categories || [book.category].filter(Boolean),
                                    ebookLink: book.ebookLink,
                                    isbn: book.isbn
                                };

                                // Enable or disable the borrow button based on status and copies
                                if (book.copies === 0 || book.status.toLowerCase() === "checked out") {
                                    borrowButton.disabled = true;
                                    borrowButton.textContent = "Not Available";
                                } else {
                                    borrowButton.disabled = false;
                                    borrowButton.textContent = "Borrow";
                                }

                                // Load reviews
                                loadReviews(book.title);
                                // Load similar books
                                loadSimilarBooks(book.category || 'all');
                                // Load borrowing history
                                loadBorrowingHistory(book.title);

                                // Set the author meta span
                                document.getElementById('modal-book-author-meta').textContent = book.author || 'Unknown';

                                modal.style.display = 'block';
                            });
                    }
                    
                    // Function to generate star rating
                    function generateStarRating(rating) {
                        const fullStars = Math.floor(rating);
                        const hasHalfStar = rating % 1 >= 0.5;
                        let starsHTML = '';
                        
                        // Add full stars
                        for (let i = 0; i < fullStars; i++) {
                            starsHTML += '<i class="fas fa-star"></i>';
                        }
                        
                        // Add half star if needed
                        if (hasHalfStar) {
                            starsHTML += '<i class="fas fa-star-half-alt"></i>';
                        }
                        
                        // Add empty stars
                        const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                        for (let i = 0; i < emptyStars; i++) {
                            starsHTML += '<i class="far fa-star"></i>';
                        }
                        
                        return starsHTML + ` ${rating}`;
                    }
                    
                    // Function to generate a random ISBN
                    function generateRandomISBN() {
                        const prefix = "978";
                        let isbn = prefix;
                        
                        // Generate 10 random digits
                        for (let i = 0; i < 10; i++) {
                            isbn += Math.floor(Math.random() * 10);
                        }
                        
                        // Format with hyphens: 978-x-xxx-xxxxx-x
                        return `${isbn.substring(0, 3)}-${isbn.substring(3, 4)}-${isbn.substring(4, 7)}-${isbn.substring(7, 12)}-${isbn.substring(12)}`;
                    }
                    
                    // Function to generate a random past date
                    function generateRandomDate() {
                        const year = Math.floor(Math.random() * 30) + 1990;
                        const month = Math.floor(Math.random() * 12) + 1;
                        const day = Math.floor(Math.random() * 28) + 1;
                        
                        return `${month}/${day}/${year}`;
                    }
                    
                    // Function to get section based on category
                    function getCategorySection(category) {
                        if (!category) return "General";
                        
                        const sections = {
                            'it': 'Technology',
                            'math': 'Sciences',
                            'science': 'Sciences',
                            'politics': 'Social Sciences',
                            'history': 'History',
                            'language': 'Languages',
                            'pe and health': 'Health',
                            'philosophy': 'Humanities'
                        };
                        
                        return sections[category.toLowerCase()] || "General";
                    }
                    
                    // Function to generate a random shelf
                    function generateRandomShelf() {
                        const section = String.fromCharCode(65 + Math.floor(Math.random() * 6)); // A to F
                        const number = Math.floor(Math.random() * 20) + 1;
                        return `${section}${number}`;
                    }
                    
                    // Function to handle tab switching
                    function openTab(evt, tabName) {
                        // Declare all variables
                        let i, tabcontent, tabbuttons;

                        // Get all elements with class="tab-content" and hide them
                        tabcontent = document.getElementsByClassName("tab-content");
                        for (i = 0; i < tabcontent.length; i++) {
                            tabcontent[i].style.display = "none";
                            tabcontent[i].classList.remove("active");
                        }

                        // Get all elements with class="tab-button" and remove the class "active"
                        tabbuttons = document.getElementsByClassName("tab-button");
                        for (i = 0; i < tabbuttons.length; i++) {
                            tabbuttons[i].classList.remove("active");
                        }

                        // Show the current tab, and add an "active" class to the button that opened the tab
                        document.getElementById(tabName).style.display = "block";
                        document.getElementById(tabName).classList.add("active");
                        
                        if (evt) {
                            evt.currentTarget.classList.add("active");
                        } else {
                            // If no event is provided, activate the first tab
                            document.querySelector(`.tab-button[onclick*="${tabName}"]`).classList.add("active");
                        }
                    }
                    
                    // Function to load reviews for a book
                    function loadReviews(bookTitle) {
                        const reviewsList = document.getElementById('book-reviews');
                        
                        // Get reviews from localStorage
                        const allReviews = JSON.parse(localStorage.getItem("bookReviews")) || {};
                        const bookReviews = allReviews[bookTitle] || [];
                        
                        // Clear the list
                        reviewsList.innerHTML = "";
                        
                        if (bookReviews.length === 0) {
                            reviewsList.innerHTML = '<p class="no-reviews">No reviews yet. Be the first to review this book!</p>';
                            return;
                        }
                        
                        // Display each review
                        bookReviews.forEach(review => {
                            const reviewItem = document.createElement("div");
                            reviewItem.className = "review-item";
                            
                            reviewItem.innerHTML = `
                                <div class="review-header">
                                    <span class="reviewer-name">${review.username}</span>
                                    <span class="review-date">${new Date(review.date).toLocaleDateString()}</span>
                                </div>
                                <div class="review-rating">${generateStarRating(review.rating)}</div>
                                <div class="review-text">${review.text}</div>
                            `;
                            
                            reviewsList.appendChild(reviewItem);
                        });
                    }
                    
                    // Function to submit a review
                    function submitReview() {
                        if (!window.currentBook) return;
                        
                        const { title } = window.currentBook;
                        const reviewText = document.getElementById('review-text').value.trim();
                        const starsSelected = document.querySelectorAll('.star-input i.active').length;
                        
                        if (reviewText === "" || starsSelected === 0) {
                            alert("Please provide both a rating and a review text.");
                            return;
                        }
                        
                        // Create review object
                        const review = {
                            username: localStorage.getItem('currentUser') || "Anonymous",
                            rating: starsSelected,
                            text: reviewText,
                            date: new Date().toISOString()
                        };
                        
                        // Get existing reviews
                        let allReviews = JSON.parse(localStorage.getItem("bookReviews")) || {};
                        
                        // Initialize array for this book if it doesn't exist
                        if (!allReviews[title]) {
                            allReviews[title] = [];
                        }
                        
                        // Add new review
                        allReviews[title].unshift(review);
                        
                        // Save to localStorage
                        localStorage.setItem("bookReviews", JSON.stringify(allReviews));
                        
                        // Update the UI
                        loadReviews(title);
                        
                        // Reset form
                        document.getElementById('review-text').value = "";
                        document.querySelectorAll('.star-input i').forEach(star => {
                            star.classList.remove('active');
                        });
                        
                        alert("Thank you for your review!");
                    }
                    
                    // Function to load similar books
                    function loadSimilarBooks(category) {
                        const similarBooksContainer = document.getElementById('similar-books-container');
                        const books = JSON.parse(localStorage.getItem("books")) || [];
                        const currentBookTitle = window.currentBook?.title;
                        
                        // Find the current book data
                        const currentBook = books.find(b => b.title === currentBookTitle);
                        
                        // Find books with similar categories
                        const similarBooks = books.filter(book => {
                            // Skip the current book
                            if (book.title === currentBookTitle) return false;
                            
                            // For books with multiple categories
                            if (currentBook?.categories && Array.isArray(currentBook.categories) && 
                                book.categories && Array.isArray(book.categories)) {
                                // Check if any category matches
                                return currentBook.categories.some(cat => 
                                    book.categories.includes(cat)
                                );
                            }
                            
                            // For books with single category
                            const bookCategory = book.category || book.genre;
                            const mainCategory = (currentBook?.categories && currentBook.categories.length > 0) 
                                              ? currentBook.categories[0] 
                                              : (currentBook?.category || category);
                                              
                            return category === 'all' || bookCategory === mainCategory;
                        }).slice(0, 6); // Limit to 6 books
                        
                        if (similarBooks.length === 0) {
                            similarBooksContainer.innerHTML = '<p>No similar books found.</p>';
                            return;
                        }
                        
                        similarBooksContainer.innerHTML = '';
                        
                        // Display each similar book
                        similarBooks.forEach(book => {
                            const bookItem = document.createElement("div");
                            bookItem.className = "similar-book-item";
                            
                            bookItem.innerHTML = `
                                <img class="similar-book-cover" src="${book.image}" alt="${book.title}" 
                                    onclick="showBookDetails('${book.title}', '${book.image}', '${book.description}', '${book.status}', ${book.copies})">
                                <div class="similar-book-title">${book.title}</div>
                                <div class="similar-book-author">${book.author || 'Unknown'}</div>
                            `;
                            
                            similarBooksContainer.appendChild(bookItem);
                        });
                    }
                    
                    // Function to load borrowing history for a book
                    function loadBorrowingHistory(bookTitle) {
                        const historyContainer = document.getElementById('borrowing-history-container');
                        
                        // Get all book requests
                        const bookRequests = JSON.parse(localStorage.getItem("bookRequests")) || [];
                        
                        // Filter requests for this book
                        const bookHistory = bookRequests.filter(request => request.title === bookTitle);
                        
                        if (bookHistory.length === 0) {
                            historyContainer.innerHTML = '<p>No borrowing history available for this book.</p>';
                            return;
                        }
                        
                        // Sort history by date (most recent first)
                        bookHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
                        
                        // Create table for history
                        let historyHTML = `
                            <table>
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>User</th>
                                        <th>Status</th>
                                        <th>Due Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                        `;
                        
                        bookHistory.forEach(record => {
                            const formattedDate = new Date(record.date).toLocaleDateString();
                            const formattedDueDate = record.dueDate ? new Date(record.dueDate).toLocaleDateString() : 'N/A';
                            
                            historyHTML += `
                                <tr>
                                    <td>${formattedDate}</td>
                                    <td>${record.username}</td>
                                    <td>${record.status}</td>
                                    <td>${formattedDueDate}</td>
                                </tr>
                            `;
                        });
                        
                        historyHTML += `
                                </tbody>
                            </table>
                        `;
                        
                        historyContainer.innerHTML = historyHTML;
                    }
                    
                    // Add to wishlist function
                    function addToWishlist() {
                        if (!window.currentBook) return;
                        
                        const { title, image, author } = window.currentBook;
                        
                        // Get current wishlist
                        let wishlist = JSON.parse(localStorage.getItem("userWishlist")) || [];
                        
                        // Check if book is already in wishlist
                        if (wishlist.some(item => item.title === title)) {
                            alert("This book is already in your wishlist.");
                            return;
                        }
                        
                        // Add to wishlist
                        wishlist.push({
                            title,
                            image,
                            author,
                            dateAdded: new Date().toISOString()
                        });
                        
                        // Save to localStorage
                        localStorage.setItem("userWishlist", JSON.stringify(wishlist));
                        
                        alert("Book added to your wishlist!");
                    }
                    
                    // Share book function
                    function shareBook() {
                        if (!window.currentBook) return;
                        
                        const { title, author } = window.currentBook;
                        
                        // Simulate sharing by creating a share text
                        const shareText = `Check out this book: "${title}" by ${author} at LitArchive!`;
                        
                        // Create a temporary textarea element
                        const textArea = document.createElement('textarea');
                        textArea.value = shareText;
                        
                        // Make the textarea out of the viewport
                        textArea.style.position = 'fixed';
                        textArea.style.left = '-999999px';
                        textArea.style.top = '-999999px';
                        document.body.appendChild(textArea);
                        
                        // Select the text
                        textArea.focus();
                        textArea.select();
                        
                        // Copy the text
                        let copied = false;
                        try {
                            copied = document.execCommand('copy');
                        } catch (err) {
                            console.error('Failed to copy text: ', err);
                        }
                        
                        // Remove the textarea
                        document.body.removeChild(textArea);
                        
                        if (copied) {
                            alert('Share text copied to clipboard: ' + shareText);
                        } else {
                            alert('Failed to copy share text to clipboard.');
                        }
                    }
                    
                    // Initialize star rating input
                    document.addEventListener('DOMContentLoaded', function() {
                        const stars = document.querySelectorAll('.star-input i');
                        
                        stars.forEach(star => {
                            star.addEventListener('click', function() {
                                const rating = this.getAttribute('data-rating');
                                
                                // Reset all stars
                                stars.forEach(s => s.classList.remove('active'));
                                
                                // Activate stars up to the clicked one
                                stars.forEach(s => {
                                    if (s.getAttribute('data-rating') <= rating) {
                                        s.classList.add('active');
                                    }
                                });
                            });
                        });
                    });

                    // Function to close the modal
                    function closeBookModal() {
                        const modal = document.getElementById('book-modal');
                        modal.style.opacity = '0';
                        setTimeout(() => {
                            modal.style.display = 'none';
                            modal.style.opacity = '1';
                        }, 300);
                    }
                    
                    // Function to open eBook link
                    function openEbook() {
                        const ebookButton = document.getElementById('ebook-button');
                        let ebookLink = ebookButton ? ebookButton.getAttribute('data-ebook-link') : null;
                        if (!ebookLink || ebookLink.trim() === "") {
                            // Fallback: fetch the book details from the backend
                            const currentBookTitle = document.getElementById('modal-book-title').textContent.trim().toLowerCase();
                            fetch('http://192.168.1.16:3001/api/books')
                                .then(response => response.json())
                                .then(books => {
                                    const book = books.find(b => (b.title || '').trim().toLowerCase() === currentBookTitle);
                                    ebookLink = (book && (book.ebookLink || book.link)) ? (book.ebookLink || book.link) : null;
                                    if (ebookLink && ebookLink.trim() !== "") {
                                        if (!ebookLink.startsWith('http://') && !ebookLink.startsWith('https://')) {
                                            ebookLink = 'http://' + ebookLink;
                                        }
                                        window.open(ebookLink, '_blank');
                                    } else {
                                        alert('No eBook link available for this book.');
                                    }
                                })
                                .catch(() => {
                                    alert('Failed to fetch book details from the database.');
                                });
                        } else {
                            if (!ebookLink.startsWith('http://') && !ebookLink.startsWith('https://')) {
                                ebookLink = 'http://' + ebookLink;
                            }
                            window.open(ebookLink, '_blank');
                        }
                    }

                    // Show the borrow confirmation modal
                    function showBorrowConfirmModal(bookTitle) {
                        const modal = document.getElementById('borrow-confirm-modal');
                        const titleElem = document.getElementById('borrow-confirm-title');
                        const dateInput = document.getElementById('return-date');
                        titleElem.textContent = `Do you want to borrow "${bookTitle}"?`;
                        const today = new Date().toISOString().split('T')[0];
                        dateInput.value = '';
                        dateInput.min = today;
                        modal.classList.add('active');
                        modal.dataset.bookTitle = bookTitle;
                        const confirmBtn = document.getElementById('confirm-borrow-btn');
                        const cancelBtn = document.getElementById('cancel-borrow-btn');
                        if (confirmBtn) {
                            confirmBtn.onclick = function() {
                                const bookTitle = modal.dataset.bookTitle;
                                const returnDate = dateInput.value;
                                if (!returnDate) {
                                    alert('Please select a return date.');
                                    return;
                                }
                                // Get user
                                const currentUserRaw = localStorage.getItem("currentUser");
                                let currentUser;
                                let username = '';
                                try {
                                    currentUser = JSON.parse(currentUserRaw);
                                    if (typeof currentUser === 'object' && currentUser !== null) {
                                        username = currentUser.username || currentUser.name || String(currentUser) || "User";
                                    } else {
                                        username = String(currentUser);
                                    }
                                } catch (e) {
                                    username = currentUserRaw || "User";
                                }
                                // Save borrow info (localStorage fallback)
                                let borrowRequests = JSON.parse(localStorage.getItem("borrowRequests")) || [];
                                borrowRequests.push({
                                    username: username,
                                    bookTitle: bookTitle,
                                    date: new Date().toLocaleString(),
                                    returnDate: returnDate,
                                    status: "Borrowed"
                                });
                                localStorage.setItem("borrowRequests", JSON.stringify(borrowRequests));

                                // --- DIRECT FIX: Always update borrowedBooks for profile page ---
                                let borrowedBooks = JSON.parse(localStorage.getItem("borrowedBooks")) || [];
                                borrowedBooks.push({
                                    username: username,
                                    title: bookTitle,
                                    date: new Date().toISOString()
                                });
                                localStorage.setItem("borrowedBooks", JSON.stringify(borrowedBooks));
                                // --- END DIRECT FIX ---

                                console.log("Added to borrowedBooks:", borrowedBooks[borrowedBooks.length - 1]);
                                console.log("All borrowedBooks:", borrowedBooks);

                                hideBorrowConfirmModal();
                                closeBookModal();
                                alert(`Book borrowed, return by ${returnDate}.`);
                            };
                        }
                        if (cancelBtn) {
                            cancelBtn.onclick = function() {
                                hideBorrowConfirmModal();
                            };
                        }
                    }
                </script>
                <script src="./css and js/fixes.js"></script>
                <script src="./css and js/script.js"></script>
                <script src="./css and js/darkmode.js"></script>
            </body>
        </html>